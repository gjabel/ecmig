track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 2016) %>%
select(league, alpha3, n),
order = d0$label_cd, #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
# xmax = c2
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
d0
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 2016) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
# xmax = c2
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 2016) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
# xmax = c2
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
circos.clear()
circos.par(track.margin=c(0.01, -0.01), gap.degree = 5,
start.degree = 90, points.overflow.warning = FALSE)
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 2016) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
# xmax = c2
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
circos.clear()
circos.par(track.margin=c(0.01, -0.01), points.overflow.warning = FALSE)
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 2016) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
# xmax = c2
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
# # tween
# d2 <- d1 %>%
#   mutate(corridor = paste(orig, dest, sep = " -> ")) %>%
get.cell.meta.data("sector.index")
d0
m <- d0 %>%
select(label_cd, n) %>%
deframe()
m
circos.clear()
circos.par(track.margin=c(0.01, -0.01), points.overflow.warning = FALSE)
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 2016) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
xmax = m
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 1960) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
xmax = m
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
m
d1
View(d1)
View(d)
View(x1)
d <- tibble(
year = seq(1960, 2020, 4),
teams = c(rep(4, 5), rep(8, 4), rep(16, 5), rep(24, 2)),
url = paste0("https://en.wikipedia.org/wiki/UEFA_Euro_", year, "_squads")
) %>%
# wait for euro2020 squads
slice(-n())
get_players <- function(u, n){
# u = d$url[i]
# n = d$teams[i]
h <- read_html(u)
hh <- h %>%
html_nodes("table.sortable")
p <- hh %>%
html_table() %>%
.[1:n]
s <- h %>%
html_nodes(".mw-headline") %>%
html_text() %>%
str_subset(pattern = "Group", negate = TRUE) %>%
.[1:n]
p0 <- tibble(
squad = s,
player = p) %>%
mutate(player = map(.x = player, .f = ~mutate(.x, across(everything(), as.character)))) %>%
unnest(cols = player)
p0$url_player <- hh %>%
.[1:n] %>%
html_nodes(".nat-fs-player th a") %>%
html_attr("href") %>%
str_subset(pattern = "Captain", negate = TRUE) %>%
# frank de boer in euro 1996
{if(str_detect(string = u, pattern = "1996")) .[-28] else . }
c0 <- tibble(
url = hh %>%
.[1:n] %>%
# html_nodes("td:nth-last-child(1") %>%
html_nodes("td:nth-last-child(1) a") %>%
html_attr("href"),
text = hh %>%
.[1:n] %>%
html_nodes("td:nth-last-child(1) a") %>%
html_text(),
title = hh %>%
.[1:n] %>%
html_nodes("td:nth-last-child(1) a") %>%
html_attr("title")
) %>%
filter(!str_detect(string = url, pattern = "#cite")) %>%
mutate(id = 1:n(),
id = ifelse(text == "", lead(id), id),
id = as.character(id),
id = fct_inorder(id),
id = as.numeric(id))
c1 <- c0 %>%
filter(text != "") %>%
rename(url_club = url,
club = text,
club_title = title)
c2 <- c0 %>%
filter(text == "") %>%
select(-text) %>%
rename(url_club_country = url,
club_country_title = title)
c3 <- tibble(
url_club_country = hh %>%
.[1:n] %>%
html_nodes(".flagicon") %>%
html_nodes("a") %>%
html_attr("href"),
club_country = hh %>%
.[1:n] %>%
html_nodes(".flagicon") %>%
html_nodes(".thumbborder") %>%
html_attr("alt")
) %>%
distinct()
c4 <- c1 %>%
left_join(c2, by = "id") %>%
left_join(c3, by = "url_club_country")
p1 <- p0 %>%
mutate(id = 1:n()) %>%
left_join(c4, by = "id")
return(p1)
}
d0 <- d %>%
mutate(players = map2(.x = url, .y = teams,
.f = ~get_players(u = .x, n = .y)))
d1 <- d0 %>%
unnest(cols = c("players")) %>%
clean_names() %>%
select(-url, -teams) %>%
mutate(pos = str_sub(string = pos, start = 2),
captain = str_detect(string = player, pattern = "captain|Captain"),
player_original = player,
player = str_remove(string = player, pattern = " \\s*\\([^\\)]+\\)"))
write_excel_csv(d1 , "./data/wiki_players.csv")
d1
d1 %>% group_by(year, squad) %>% count()
x = d1 %>% group_by(year, squad) %>% count()
View(x)
d1 <- x1 %>%
filter(!staff) %>%
filter(year >= 1980) %>%
left_join(x2) %>%
select(year, team, club, league_country, alpha3) %>%
replace_na(list(league_country = "No Club")) %>%
rename(league = league_country) %>%
mutate(team = ifelse(team == "CSSR", "Czechoslovakia", team))
x4 <- d1 %>%
select(alpha3, team) %>%
distinct() %>%
rename(label = team)
d0 <- d1 %>%
pivot_longer(cols = c("league", "alpha3"),
names_to = "type", values_to = "label_cd") %>%
group_by(year, type, label_cd) %>%
summarise(n = n()) %>%
group_by(label_cd) %>%
filter(n == max(n)) %>%
select(-year) %>%
distinct() %>%
left_join(x4, by = c("label_cd" = "alpha3")) %>%
mutate(label = ifelse(is.na(label), label_cd, label),
label_cd = factor(
x = label_cd,
levels = c(x3$alpha3, unique(rev(d1$league))))
) %>%
arrange(label_cd)
m <- d0 %>%
select(label_cd, n) %>%
deframe()
m
d1 <- d1 %>%
group_by(league, team, year, alpha3) %>%
summarise(n = n()) %>%
ungroup()
# colours
p <- x1 %>%
select(team, alpha3) %>%
left_join(x3)
c1 <- p %>%
select(team, shirt) %>%
distinct() %>%
deframe()
c2 <- p %>%
select(team, shorts) %>%
distinct() %>%
deframe()
circos.clear()
circos.par(track.margin=c(0.01, -0.01), points.overflow.warning = FALSE)
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 1960) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
xmax = m
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
circos.clear()
circos.par(track.margin=c(0.01, -0.01), points.overflow.warning = FALSE)
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 1980) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
xmax = m
)
circos.track(
track.index = 1, bg.border = NA,
panel.fun = function(x, y) {
s <- get.cell.meta.data("sector.index")
dd <- filter(d0, label_cd == s)
xx <- get.cell.meta.data("xlim")
circos.text(x = mean(xx), y = 0.6, labels = dd$label,
facing = "clockwise", niceFacing = TRUE, adj = 0)
# circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               minor.ticks = FALSE,
#               labels.cex = 0.7,
#               labels.pos.adjust = FALSE,
#               labels.niceFacing = FALSE)
#   circos.axis(h = "bottom",
#               major.at = seq(from = 0, to = max(c2)+10, by = 10),
#               labels = NULL)
})
c0
c1
names(c1)
names(c1) == d1$league
names(c1) == d1$team
names(c1) == d0$team
names(c1) == d0$label
circos.clear()
circos.par(track.margin=c(0.01, -0.01), points.overflow.warning = FALSE)
# plot the chord diagram
chordDiagram(
x = d1 %>%
# filter(.frame == f) %>%
filter(year == 1980) %>%
select(league, alpha3, n),
order = rev(d0$label_cd), #grid.col = c0, transparency = 0.25,
directional = 1, direction.type = c("diffHeight", "arrows"),
link.arr.type = "big.arrow", diffHeight  = -0.05,
link.sort = TRUE, link.largest.ontop = TRUE,
annotationTrack = "grid",
annotationTrackHeight = 0.05,
preAllocateTracks = list(track.height = 0.12),
# xmax = m
)
d1
d1
